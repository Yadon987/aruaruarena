- [重要度: 高]
- 問題点: 受入基準にある「旧キー `aruaruarena_my_posts` からの移行」がテスト計画に含まれていない。
- 改善提案: `my_post_ids` が空かつ旧キーが有効な場合に移行し、旧キーを削除するREDテスト（T-14）を追加する。

- [重要度: 高]
- 問題点: 仕様で要求される「一覧表示時の同時3件まで並列取得」の制約が未検証。
- 改善提案: API呼び出しの同時実行数が3を超えないことを検証するREDテスト（T-15）を追加する。

- [重要度: 中]
- 問題点: RED成立条件が「失敗すること」のみで、十分な失敗件数の定量基準がないため、1件失敗でも成立扱いになる。
- 改善提案: 初回RED実行でAC対応テストが最低8件以上失敗することを成立条件へ追加する。

- [重要度: 中]
- 問題点: テスト対象ファイル名が既存命名規則と一部不整合（`MyPostDetail.integration.red.test.tsx` は既存に `.integration.test.tsx` が存在）。
- 改善提案: 既存ファイルの拡張に寄せるか、新規作成時は命名衝突を避けるため `myPostDetail.integration.red.test.tsx` に統一する。

- [重要度: 低]
- 問題点: E2E計画に `role="dialog"` / `aria-modal="true"` の検証がなく、アクセシビリティ要件の網羅が弱い。
- 改善提案: E2E-04としてダイアログ属性検証を追加する。

完全版:

```md
# REDテスト計画書（改訂版）: E16-01〜E16-04 自分の投稿一覧（フロントエンド）

## 0. 目的

`.github/E16-01_MY_POSTS_LIST_FRONTEND_SPEC.md` の受入基準（AC）を、実装前にREDテストとして固定する。

- 対象: `my_post_ids` 正規化、旧キー移行、投稿一覧モーダル、投稿詳細遷移、エラー時挙動、キーボード操作、同時実行制御
- ゴール: Green実装時の判断ブレを防ぎ、仕様未実装をテスト失敗で明確化する

---

## 1. 前提・制約（CLAUDE.md準拠）

- REDテストは必ず失敗する状態で追加する
- 失敗理由は「仕様未実装」または「仕様不一致」に限定する
- `skip` / `todo` / `only` は使用しない
- 各テストケースに `何を検証するか` の日本語コメントを必ず付与する
- テスト名・コメント・コミットメッセージは日本語で記述する
- 機密情報はテストコードに直接記載しない

---

## 2. RED成立条件

有効なRED失敗:
- `my_post_ids` の正規化（UUID除外・重複除外・20件上限）が未実装
- 旧キー `aruaruarena_my_posts` からの移行が未実装
- 一覧表示時の同時3件まで並列取得が未実装
- 投稿一覧モーダルのアクセシビリティ要件（`role="dialog"`, `aria-modal`, フォーカス復帰）が未実装
- 投稿クリック時の遷移仕様（一覧を閉じて結果モーダルを開く）が未実装
- `404` 時削除 / `500` 時保持 / 再試行導線が未実装
- 同一ID連打時の二重リクエスト抑止が未実装

無効な失敗:
- テストファイルの構文エラー
- import不備による起動失敗
- ネットワーク遮断など環境要因のみの失敗

判定ルール:
- 初回RED実行でAC対応テストが最低8件以上失敗すること
- 失敗内容が仕様未実装/不一致に紐づくこと
- 無効な失敗が0件であること

---

## 3. スコープ

### 3.1 対象
- `frontend/src/features/top/__tests__/MyPostStorage.red.test.tsx`（既存拡張）
- `frontend/src/features/top/__tests__/myPostDetail.integration.red.test.tsx`（新規）
- `frontend/src/features/top/__tests__/myPostAccessibility.red.test.tsx`（新規）
- `frontend/e2e/my-posts-modal.red.spec.ts`（新規）

### 3.2 非対象
- バックエンドAPI仕様変更
- Green実装（コンポーネント/フック本体の修正）
- 本番環境での手動ブラウザ検証

---

## 4. ACトレース（仕様→REDテスト）

- AC-01 投稿一覧表示: T-01, T-02, T-03
- AC-02 投稿クリック遷移: T-04
- AC-03 不正JSON時フォールバック: T-05
- AC-04 404時削除: T-06
- AC-05 500時保持: T-07
- AC-06 21件以上は20件表示: T-08
- AC-07 連打時1リクエスト: T-09
- AC-08 UUID不正ID除外・正規化保存: T-10
- AC-09 キーボード開閉とフォーカス復帰: T-11, T-12
- AC-10 失敗行の再試行: T-13
- AC-11 旧キー移行: T-14
- AC-12 同時3件まで並列取得: T-15
- AC-13 ダイアログ属性: E2E-04

---

## 5. テスト設計（RED）

### 5.1 Unit/Integration（Vitest + Testing Library）

- T-01 `my_post_ids` から一覧を表示する
  - 何を検証するか: 保存済み投稿IDに対応する投稿詳細が一覧描画されること
- T-02 投稿項目（本文・平均点・順位・作成日時・ステータス）を表示する
  - 何を検証するか: 仕様で必須とされた項目が1行に揃って表示されること
- T-03 空配列時に空状態メッセージを表示する
  - 何を検証するか: 投稿0件のとき `投稿はまだありません` が表示されること
- T-04 投稿クリックで一覧を閉じて結果モーダルを開く
  - 何を検証するか: モーダル切り替え遷移が仕様どおり発火すること
- T-05 `my_post_ids` が不正JSONでもクラッシュしない
  - 何を検証するか: 不正JSONを空配列として扱いUIが継続表示できること
- T-06 `404` 発生時に該当IDを `my_post_ids` から削除する
  - 何を検証するか: `NOT_FOUND` で削除し、再描画後に該当行が消えること
- T-07 `500` 発生時に `my_post_ids` を保持する
  - 何を検証するか: 一時障害では削除せず維持すること
- T-08 21件以上保存時に20件へ切り詰める
  - 何を検証するか: 上限20件表示と保存正規化が実行されること
- T-09 同一ID連打でも詳細取得は1回
  - 何を検証するか: in-flight制御で重複リクエストを抑止すること
- T-10 UUID形式外IDを除外して保存し直す
  - 何を検証するか: 不正IDが描画・API呼び出し対象から除外されること
- T-11 `Enter` / `Space` で投稿一覧モーダルを開ける
  - 何を検証するか: キーボード操作での開閉導線が成立すること
- T-12 `Esc` で閉じてトリガーへフォーカス復帰する
  - 何を検証するか: アクセシビリティのフォーカス管理が成立すること
- T-13 取得失敗行の `再試行` で再取得できる
  - 何を検証するか: 失敗後の回復導線が存在し、再リクエストできること
- T-14 旧キー `aruaruarena_my_posts` から `my_post_ids` へ移行する
  - 何を検証するか: 新キー空時のみ移行し、旧キーを削除すること
- T-15 一覧詳細取得の同時実行数が3件を超えない
  - 何を検証するか: 並列取得制限（最大3件）が守られること

### 5.2 E2E（Playwright）

- E2E-01 `自分の投稿一覧` ボタンのクリックでモーダルを開閉できる
  - 何を検証するか: 主要導線がブラウザ上で動作すること
- E2E-02 `Enter` / `Space` / `Esc` のキーボード操作で開閉できる
  - 何を検証するか: キーボード操作要件を満たすこと
- E2E-03 投稿選択で結果モーダルへ切り替わる
  - 何を検証するか: 投稿一覧→結果モーダルの遷移が成立すること
- E2E-04 モーダルに `role=\"dialog\"` と `aria-modal=\"true\"` が設定される
  - 何を検証するか: ダイアログのアクセシビリティ属性が満たされること

---

## 6. 実装手順（REDテスト追加）

1. `MyPostStorage.red.test.tsx` に T-05/T-08/T-10/T-14 を追加
2. `myPostDetail.integration.red.test.tsx` を新規作成し T-01/T-02/T-04/T-06/T-07/T-09/T-13/T-15 を追加
3. `myPostAccessibility.red.test.tsx` を新規作成し T-11/T-12 を追加
4. `frontend/e2e/my-posts-modal.red.spec.ts` を新規作成し E2E-01〜04 を追加
5. RED実行で失敗が仕様未実装由来であることを確認

---

## 7. RED実行コマンド

`frontend` ディレクトリで実行:

1. `npm ci`
2. `npx vitest run src/features/top/__tests__/MyPostStorage.red.test.tsx src/features/top/__tests__/myPostDetail.integration.red.test.tsx src/features/top/__tests__/myPostAccessibility.red.test.tsx`
3. `npx playwright test e2e/my-posts-modal.red.spec.ts`

---

## 8. 完了条件（RED）

- ACをカバーするREDテスト一覧が定義されている
- すべてのテストケースに `何を検証するか` コメント方針が含まれている
- 初回実行でAC対応テストが8件以上失敗する（仕様未実装/不一致）
- 無効失敗（構文/環境起因）が0件である

---

## 9. コミット方針

コミットメッセージ案（Issue番号必須）:

`test: E16-01 REDテスト計画を追加 #74`

コミット本文案:
- E16仕様のACをREDテストケースへ分解
- 失敗条件と無効失敗の判定ルールを追加
- 各テストへの「何を検証するか」コメント必須ルールを追加
- 分割コミット時も全コミットに `#74` を付与する
```
