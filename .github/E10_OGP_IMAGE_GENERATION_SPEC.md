---
name: ä»•æ§˜ç­–å®š (Spec)
about: æ–°æ©Ÿèƒ½ã‚„æ”¹å–„ã®ä»•æ§˜ã‚’å®šç¾©ã™ã‚‹éš›ã«ä½¿ç”¨ (SDD/TDD/BDDæº–æ‹ )
title: '[SPEC] E10-00ã€œE10-05: OGPç”»åƒç”Ÿæˆ (Image Generation)'
labels: 'spec, E10'
assignees: ''
---

## ğŸ“‹ æ¦‚è¦
SNSã‚·ã‚§ã‚¢æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹OGPç”»åƒã‚’å‹•çš„ã«ç”Ÿæˆã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥é…ä¿¡ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ImageMagickã‚’ä½¿ç”¨ã—ã¦æŠ•ç¨¿å†…å®¹ã‚„ã‚¹ã‚³ã‚¢ã‚’ç”»åƒã«åˆæˆã—ã€CloudFrontã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ã§é«˜é€Ÿãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ğŸ¯ ç›®çš„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒSNSã§ã‚·ã‚§ã‚¢ã—ãŸéš›ã«ã€æŠ•ç¨¿å†…å®¹ã‚„ã‚¹ã‚³ã‚¢ãŒä¸€ç›®ã§ã‚ã‹ã‚‹ã‚ˆã†ã«ã—ã€ã‚¯ãƒªãƒƒã‚¯ç‡ï¼ˆCTRï¼‰ã‚’å‘ä¸Šã•ã›ã‚‹
- è¦–è¦šçš„ãªã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’ä¸ãˆã‚‹ã“ã¨ã§ã€æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æµå…¥ã‚’ä¿ƒé€²ã™ã‚‹

---

## ğŸ“ è©³ç´°ä»•æ§˜

### æ©Ÿèƒ½è¦ä»¶
- **ç”»åƒåˆæˆ**: ãƒ™ãƒ¼ã‚¹ç”»åƒã«ä»¥ä¸‹ã®æƒ…å ±ã‚’åˆæˆã™ã‚‹
  - æŠ•ç¨¿æœ¬æ–‡ï¼ˆ3-30æ–‡å­—ï¼‰
  - ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆ1-20æ–‡å­—ï¼‰
  - ç·åˆã‚¹ã‚³ã‚¢ï¼ˆ0-100ç‚¹ã€å°æ•°ç¬¬1ä½ã¾ã§è¡¨ç¤ºï¼‰
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°é †ä½ï¼ˆç¬¬Xä½ã€åœå¤–ã®å ´åˆã¯ã€Œåœå¤–ã€ï¼‰
  - å„å¯©æŸ»å“¡ã®ã‚¹ã‚³ã‚¢ã¨ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ`succeeded: true` ã®å¯©æŸ»å“¡ã®ã¿è¡¨ç¤ºï¼‰
    - hiroyuki: é’ç³»ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ #4A90E2
    - dewi: æ©™ç³»ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ #F5A623
    - nakao: èµ¤ç³»ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ #D0021B
- **éåŒæœŸç”Ÿæˆ**: å¯©æŸ»å®Œäº†æ™‚ã«Threadã‚’ä½¿ç”¨ã—ã¦éåŒæœŸã§ç”»åƒã‚’ç”Ÿæˆï¼ˆã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ï¼‰ã™ã‚‹
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ç”Ÿæˆã•ã‚ŒãŸç”»åƒã¯CloudFrontã§1é€±é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹
- **ç’°å¢ƒæ§‹ç¯‰**: Dockerã‚³ãƒ³ãƒ†ãƒŠã«ImageMagickã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

### éæ©Ÿèƒ½è¦ä»¶
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ç”»åƒç”Ÿæˆå‡¦ç†ã¯éåŒæœŸã§è¡Œã„ã€ãƒ¡ã‚¤ãƒ³ã®å¯©æŸ»ãƒ•ãƒ­ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼ˆæœ€å¤§0.5ç§’å¾…æ©Ÿï¼‰
- **å¯ç”¨æ€§**: ç”»åƒç”Ÿæˆå¤±æ•—æ™‚ã¯nilã‚’è¿”ã—ã€404ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: mini_magickã®APIã‚’ä½¿ç”¨ã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’é˜²ã
- **ãƒ­ã‚°å‡ºåŠ›**: é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã§ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’å‡ºåŠ›ã™ã‚‹

### UI/UXè¨­è¨ˆ
- ç”»åƒã‚µã‚¤ã‚º: 1200x630pxï¼ˆOGPæ¨å¥¨ã‚µã‚¤ã‚ºï¼‰
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:
  - ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ : å¤ªå­—ã€ã‚µã‚¤ã‚º48ptã€è‰²#333333ã€ä½ç½®(100, 100)
  - æœ¬æ–‡: é€šå¸¸ã€ã‚µã‚¤ã‚º36ptã€è‰²#333333ã€ä½ç½®(100, 160)
  - ç·åˆã‚¹ã‚³ã‚¢: å¤ªå­—ã€ã‚µã‚¤ã‚º72ptã€è‰²#FF6B6Bã€ä½ç½®(900, 100)
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°: é€šå¸¸ã€ã‚µã‚¤ã‚º36ptã€è‰²#666666ã€ä½ç½®(900, 180)
  - å¯©æŸ»å“¡æƒ…å ±ï¼ˆy_offset=250ã‹ã‚‰é–‹å§‹ï¼‰:
    - ã‚¢ã‚¤ã‚³ãƒ³: 50x50pxã€ä½ç½®(50, y_offset)
    - ã‚¹ã‚³ã‚¢: é€šå¸¸ã€ã‚µã‚¤ã‚º24ptã€å¯©æŸ»å“¡ã‚«ãƒ©ãƒ¼ã€ä½ç½®(120, y_offset + 10)
    - ã‚³ãƒ¡ãƒ³ãƒˆ: é€šå¸¸ã€ã‚µã‚¤ã‚º18ptã€è‰²#666666ã€ä½ç½®(120, y_offset + 40)ã€å…ˆé ­20æ–‡å­—
- ãƒ•ã‚©ãƒ³ãƒˆ: Noto Sans JPï¼ˆBold/Regularï¼‰
- ãƒ™ãƒ¼ã‚¹ç”»åƒ: `app/assets/images/base_ogp.png`ï¼ˆç™½èƒŒæ™¯ï¼‰

---

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« (DynamoDB)
- **Table**: `posts` (å‚ç…§ã®ã¿)
- ç”»åƒãƒ‡ãƒ¼ã‚¿è‡ªä½“ã¯ã‚ªãƒ³ã‚¶ãƒ•ãƒ©ã‚¤ç”Ÿæˆã§è¿”å´ï¼ˆCloudFrontã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

### APIè¨­è¨ˆ


| é …ç›® | å€¤ |
|------|-----|

| Method | `GET` |
| Path | `/ogp/posts/:id.png` |
| Request Body | ãªã— |
| Response (æˆåŠŸ) | ç”»åƒãƒã‚¤ãƒŠãƒª (`Content-Type: image/png`) |
| Response (å¤±æ•—) | JSONã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (`404 Not Found`) |


ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼:
```json
{
  "error": "æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
  "code": "NOT_FOUND"
}
```

### ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```ruby
class OgpGeneratorService
  IMAGE_WIDTH = 1200
  IMAGE_HEIGHT = 630
  IMAGE_FORMAT = 'PNG'

  JUDGE_COLORS = {
    'hiroyuki' => '#4A90E2',
    'dewi' => '#F5A623',
    'nakao' => '#D0021B'
  }.freeze

  BASE_IMAGE_PATH = Rails.root.join('app', 'assets', 'images', 'base_ogp.png')
  JUDGE_ICON_PATHS = {
    'hiroyuki' => Rails.root.join('app', 'assets', 'images', 'judge_hiroyuki.png'),
    'dewi' => Rails.root.join('app', 'assets', 'images', 'judge_dewi.png'),
    'nakao' => Rails.root.join('app', 'assets', 'images', 'judge_nakao.png')
  }.freeze

  def initialize(post_id)
    @post = Post.find(post_id)
    @judgments = Judgment.where(post_id: post_id).to_a
  rescue Dynamoid::Errors::RecordNotFound, Dynamoid::Errors::MissingHashKey
    Rails.logger.warn("[OgpGeneratorService] Post not found: #{post_id}")
    @post = nil
  end

  def execute
    return nil if @post.nil?
    return nil if @post.status != Post::STATUS_SCORED

    # ç”»åƒç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
  end

  class << self
    def call(post_id)
      new(post_id).execute
    end
  end
end
```

### ç”»åƒç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: `mini_magick`
- ãƒ™ãƒ¼ã‚¹ç”»åƒ: `app/assets/images/base_ogp.png`ï¼ˆç™½èƒŒæ™¯ã€1200x630pxï¼‰
- å¯©æŸ»å“¡ã‚¢ã‚¤ã‚³ãƒ³:
  - `app/assets/images/judge_hiroyuki.png`ï¼ˆ50x50pxã€ã²ã‚ã‚†ãé¢¨ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
  - `app/assets/images/judge_dewi.png`ï¼ˆ50x50pxã€ãƒ‡ãƒ´ã‚£å©¦äººé¢¨ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
  - `app/assets/images/judge_nakao.png`ï¼ˆ50x50pxã€ä¸­å°¾å½¬é¢¨ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- ãƒ•ã‚©ãƒ³ãƒˆ: æ—¥æœ¬èªå¯¾å¿œãƒ•ã‚©ãƒ³ãƒˆï¼ˆNoto Sans JPãªã©ï¼‰ã‚’Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã‚‹
  - `app/assets/fonts/NotoSansJP-Bold.otf`
  - `app/assets/fonts/NotoSansJP-Regular.otf`

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**: mini_magickã® `Image.open` ç­‰ã®APIã‚’ä½¿ç”¨
  - ç¦æ­¢: `MiniMagick::Tool::Convert.new` ã§ã®ç›´æ¥ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
  - æ¨å¥¨: `MiniMagick::Image.open`, `draw.annotate` ç­‰ã®APIã‚’ä½¿ç”¨
- **ã‚µãƒ‹ã‚¿ã‚¤ã‚º**: å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã«åˆ¶å¾¡æ–‡å­—ã‚„ç‰¹æ®Šæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€å‰Šé™¤ã¾ãŸã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—

### ãƒ­ã‚°å‡ºåŠ›
- **INFO**: OGPç”»åƒç”ŸæˆæˆåŠŸæ™‚
- **WARN**: OGPç”»åƒç”Ÿæˆå¤±æ•—æ™‚ã€Postå–å¾—å¤±æ•—æ™‚
- **ERROR**: äºˆæœŸã—ãªã„ä¾‹å¤–ç™ºç”Ÿæ™‚

ãƒ­ã‚°å½¢å¼: `[OgpGeneratorService] {message}`

### ç’°å¢ƒå¤‰æ•°
| å¤‰æ•°å | èª¬æ˜ |
|-------|------|
| `CLOUDFRONT_URL` | CloudFrontã®URLï¼ˆOGPç”»åƒã®URLç”Ÿæˆã«ä½¿ç”¨ï¼‰ |

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”» (TDD)

### Unit Test (OgpGeneratorService)
- [ ] æ­£å¸¸ç³»: æŒ‡å®šã•ã‚ŒãŸæŠ•ç¨¿IDã®ç”»åƒãƒã‚¤ãƒŠãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãŒ1æ–‡å­—ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãŒ20æ–‡å­—ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: æœ¬æ–‡ãŒ3æ–‡å­—ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: æœ¬æ–‡ãŒ30æ–‡å­—ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ç·åˆã‚¹ã‚³ã‚¢ãŒ0ç‚¹ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ç·åˆã‚¹ã‚³ã‚¢ãŒ100ç‚¹ã®å ´åˆã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ç·åˆã‚¹ã‚³ã‚¢ãŒå°æ•°ç‚¹ã‚’å«ã‚€å ´åˆã€å°æ•°ç¬¬1ä½ã¾ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒ1ä½ã®å ´åˆã€ã€Œç¬¬1ä½ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒåœå¤–ã®å ´åˆã€ã€Œåœå¤–ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: å¯©æŸ»å“¡ãŒ0äººï¼ˆå…¨å“¡å¤±æ•—ï¼‰ã®å ´åˆã€å¯©æŸ»å“¡æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨
- [ ] æ­£å¸¸ç³»: å¯©æŸ»å“¡ãŒ1äººæˆåŠŸã®å ´åˆã€1äººã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: å¯©æŸ»å“¡ãŒ3äººæˆåŠŸã®å ´åˆã€3äººå…¨å“¡è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ã‚³ãƒ¡ãƒ³ãƒˆãŒ20æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€å…ˆé ­20æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ç”»åƒã‚µã‚¤ã‚ºãŒ1200x630pxã§ã‚ã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒPNGã§ã‚ã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: æŠ•ç¨¿å†…å®¹ãŒç”»åƒã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] æ­£å¸¸ç³»: å¯©æŸ»å“¡ã”ã¨ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] ç•°å¸¸ç³»: å­˜åœ¨ã—ãªã„æŠ•ç¨¿IDã®å ´åˆã¯nilã‚’è¿”ã™ã“ã¨
- [ ] ç•°å¸¸ç³»: `judging` çŠ¶æ…‹ã®æŠ•ç¨¿ã®å ´åˆã¯nilã‚’è¿”ã™ã“ã¨
- [ ] ç•°å¸¸ç³»: `failed` çŠ¶æ…‹ã®æŠ•ç¨¿ã®å ´åˆã¯nilã‚’è¿”ã™ã“ã¨
- [ ] ç•°å¸¸ç³»: ãƒ™ãƒ¼ã‚¹ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ä¾‹å¤–ã‚’ãƒ­ã‚°å‡ºåŠ›ã—nilã‚’è¿”ã™ã“ã¨
- [ ] ç•°å¸¸ç³»: ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ä¾‹å¤–ã‚’ãƒ­ã‚°å‡ºåŠ›ã—nilã‚’è¿”ã™ã“ã¨
- [ ] å¢ƒç•Œå€¤: ç©ºæ–‡å­—ã‚„æœ€å¤§æ–‡å­—æ•°ã®å ´åˆã®æŒ™å‹•

### Request Spec (API)
- [ ] `GET /ogp/posts/:id.png`
  - æ­£å¸¸ã«ç”»åƒãŒè¿”å´ã•ã‚Œã‚‹ã“ã¨ (`Content-Type: image/png`)
  - `Cache-Control: public, max-age=604800` ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
  - ç”»åƒã‚µã‚¤ã‚ºãŒ1200x630pxã§ã‚ã‚‹ã“ã¨
- [ ] `judging` çŠ¶æ…‹ã®æŠ•ç¨¿ã¯404ã‚’è¿”ã™ã“ã¨
- [ ] `failed` çŠ¶æ…‹ã®æŠ•ç¨¿ã¯404ã‚’è¿”ã™ã“ã¨
- [ ] å­˜åœ¨ã—ãªã„IDã¯404ã‚’è¿”ã™ã“ã¨
- [ ] ä¸æ­£ãªUUIDã¯404ã‚’è¿”ã™ã“ã¨

### Service Spec (JudgePostService - ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—)
- [ ] å¯©æŸ»å®Œäº†æ™‚ã« `OgpGeneratorService.call` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨
- [ ] ThreadãŒæœ€å¤§0.5ç§’ã§å®Œäº†ã‚’å¾…æ©Ÿã™ã‚‹ã“ã¨
- [ ] OGPç”»åƒç”Ÿæˆå¤±æ•—æ™‚ã‚‚å¯©æŸ»å‡¦ç†ãŒç¶šè¡Œã•ã‚Œã‚‹ã“ã¨
- [ ] `failed` çŠ¶æ…‹ã®æŠ•ç¨¿ã§ã¯ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨

### External Service
- [ ] **S3/CloudFront**: (ä»Šå›ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§ã¯ãƒ¢ãƒƒã‚¯ä¸è¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚’ç¢ºèª)

---

## âœ… å—å…¥æ¡ä»¶ (AC) - Given-When-Then

### æ­£å¸¸ç³» (Happy Path)
- [ ] **Given** å¯©æŸ»æ¸ˆã¿ï¼ˆscoredçŠ¶æ…‹ï¼‰ã®æŠ•ç¨¿ãŒå­˜åœ¨ã™ã‚‹
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** æŠ•ç¨¿å†…å®¹ã¨ã‚¹ã‚³ã‚¢ãŒåˆæˆã•ã‚ŒãŸç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹
      **And** ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ200ã§ã‚ã‚‹
      **And** Content-TypeãŒimage/pngã§ã‚ã‚‹
      **And** Cache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ãŒ`public, max-age=604800`ã§ã‚ã‚‹
- [ ] **Given** å¯©æŸ»å‡¦ç†ãŒå®Œäº†ã™ã‚‹ï¼ˆstatus: scoredï¼‰
      **When** ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ `OgpGeneratorService` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
      **Then** åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒçŸ­ç¸®ã•ã‚Œã‚‹ï¼ˆã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æˆåŠŸï¼‰
      **And** OGPç”»åƒãŒCloudFrontã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚Œã‚‹
- [ ] **Given** æŠ•ç¨¿ã«ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã€Œå¤ªéƒã€ã€æœ¬æ–‡ã€Œã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯ã€ãŒå«ã¾ã‚Œã‚‹
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** ç”»åƒã«ã€Œå¤ªéƒã€ã¨ã€Œã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] **Given** æŠ•ç¨¿ã®ç·åˆã‚¹ã‚³ã‚¢ãŒ85.5ç‚¹ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒ10ä½
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** ç”»åƒã«ã€Œ85.5ç‚¹ã€ã¨ã€Œç¬¬10ä½ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] **Given** 3äººã®å¯©æŸ»å“¡å…¨å“¡ãŒæˆåŠŸã—ã¦ã„ã‚‹
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** ç”»åƒã«3äººã®å¯©æŸ»å“¡æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
      **And** å„å¯©æŸ»å“¡ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹

### ç•°å¸¸ç³» (Error Path)
- [ ] **Given** å­˜åœ¨ã—ãªã„æŠ•ç¨¿ID
      **When** `/ogp/posts/invalid-id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** 404ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹
      **And** ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒçµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚ã‚‹ï¼ˆ`{ error: "...", code: "NOT_FOUND" }`ï¼‰
- [ ] **Given** judgingçŠ¶æ…‹ã®æŠ•ç¨¿
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** 404ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹
- [ ] **Given** failedçŠ¶æ…‹ã®æŠ•ç¨¿
      **When** `/ogp/posts/:id.png` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
      **Then** 404ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹
- [ ] **Given** ãƒ™ãƒ¼ã‚¹ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
      **When** `OgpGeneratorService.call` ã‚’å®Ÿè¡Œã™ã‚‹
      **Then** nilãŒè¿”ã•ã‚Œã‚‹
      **And** ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹

---

## ğŸ”— é–¢é€£è³‡æ–™
- `docs/epics.md` (E10)
- `backend/app/models/post.rb`
- `backend/app/models/judgment.rb`
- `backend/app/services/judge_post_service.rb`
- ImageMagick Documentation
- mini_magick Documentation

---

**ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã¸ã®ç¢ºèªäº‹é …:**
- [ ] Dockerfileã¸ã®ImageMagickè¿½åŠ æ‰‹é †ã¯æ˜ç¢ºã‹
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆ1é€±é–“ï¼‰ã¯é©åˆ‡ã‹
- [ ] ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ã®ä¸¦åˆ—å‡¦ç†ï¼ˆThreadï¼‰ã®ãƒªã‚¹ã‚¯ã¯è€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ç”»åƒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºãŒå…·ä½“çš„ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] å¯©æŸ»å“¡ã‚¹ã‚³ã‚¢ã®è¡¨ç¤ºæ¡ä»¶ï¼ˆsucceeded: trueã®ã¿ï¼‰ãŒæ˜ç¢ºã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä»•æ§˜ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼ˆmini_magickã®APIä½¿ç”¨ï¼‰ãŒæ˜è¨˜ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ã‚°å‡ºåŠ›ã®ä»•æ§˜ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã®å…·ä½“ä¾‹ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹
- [ ] å¯©æŸ»å“¡ã‚¢ã‚¤ã‚³ãƒ³ã®ä»•æ§˜ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹
