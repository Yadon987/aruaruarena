- [重要度: 高]
- 問題点: 500系エラー時の文言仕様が Issue #74 では「投稿詳細の取得に失敗しました」だが、既存実装には別文言（ネットワーク/一時エラー）が存在し、上書き範囲が曖昧。
- 改善提案: 今回対象の最小実装では「一覧行の詳細取得失敗UI」に限定して固定文言を出す方針を明記し、既存の他導線文言は変更しないと明示する。

- [重要度: 高]
- 問題点: 投稿クリック時の「一覧モーダルを閉じる」をどのタイミングで行うか未定義で、API待機中に一覧が残る実装になる恐れがある。
- 改善提案: クリック直後に一覧モーダルを閉じ、結果モーダルはローディング表示で先に開く手順を固定する。

- [重要度: 中]
- 問題点: フォーカス復帰は「閉じる操作時」のみ対象か、「投稿クリックで閉じる場合」も対象かが不明。
- 改善提案: 本フェーズでは `閉じるボタン/Esc/背景クリック` の明示的クローズのみフォーカス復帰対象と定義し、投稿クリック遷移時は対象外とする。

- [重要度: 中]
- 問題点: 実装影響範囲が `App.tsx` のみとされているが、テスト期待値に合わせた最小UI追加で `MyPostDetail` 側に触る可能性が残る。
- 改善提案: 変更対象を「原則 `App.tsx`、必要最小限で `MyPostDetail`」に緩和し、判断基準を追記する。

- [重要度: 低]
- 問題点: 検証手順に「REDテストはすべてパス」があるが、どのテストIDに対してか対応表が弱い。
- 改善提案: 対象テストID（T-01/T-02/T-04/T-07/T-10/T-12）との対応を明記する。

完全版:

```md
# GREEN最小実装計画書（改訂版）: E16-01〜E16-04 自分の投稿一覧（フロントエンド）

## 0. 目的

`.github/E16-01_MY_POSTS_LIST_FRONTEND_RED_TEST_PLAN.md` と Issue `#74` の受入条件を満たすため、REDで失敗しているテストをパスさせる最小限の実装を定義する。

- 対象: 一覧表示項目、投稿クリック時のモーダル切替、500系失敗時の再試行導線、モーダルクローズ時のフォーカス復帰
- 方針: テストを通すための最小変更のみ実施し、最適化・設計整理はRefactorへ後送り

---

## 1. 重要制約（今回の実装方針）

- テストをパスする最小限のコードのみ変更する
- 過剰な最適化（責務分割・抽象化・命名整理）は実施しない
- エッジケース実装は今回追加しない
  - 例: UUID正規化、同時3件制御、21件上限厳密化、旧キー移行拡張
- マジックナンバーはこの段階では許容する
- 文言変更は「一覧行の詳細取得失敗UI」に限定し、既存の他導線メッセージは変更しない

---

## 2. 対象テストと失敗要因

### 2.1 対象REDテスト
- `frontend/src/features/top/__tests__/myPostDetail.integration.red.test.tsx`
- `frontend/src/features/top/__tests__/myPostAccessibility.red.test.tsx`

### 2.2 現在の主な失敗要因
- 一覧モーダル表示時に投稿詳細を先行取得していない（ID表示のみ）
- 投稿クリック時に一覧モーダルを閉じず、詳細表示を同一モーダル内で行っている
- `500` 失敗時に `投稿詳細の取得に失敗しました` と `再試行` ボタンを表示していない
- モーダルを閉じた時に `自分の投稿一覧` ボタンへフォーカス復帰していない

---

## 3. 実装スコープ（Green最小）

### 3.1 変更対象ファイル
- 原則: `frontend/src/App.tsx`
- 例外: テストを通すために不可避な場合のみ `frontend/src/features/top/components/MyPostDetail.tsx` を最小変更

### 3.2 実装内容
1. 投稿一覧モーダル表示時の詳細取得
- `my_post_ids` を元に表示中IDの詳細を取得する処理を追加
- 取得済み詳細はローカルstateに保持し、一覧行に表示する
- 行表示は「本文・平均点・順位・作成日時・ステータス」を最小表示する

2. 投稿クリック時のモーダル切替
- クリック直後に投稿一覧モーダルを閉じる
- 同時に `ResultModal` をローディング状態で開く
- 取得済み詳細がある場合は `openResultModal` の初期値に渡す

3. 500系失敗時の再試行導線
- 一覧行ごとに取得失敗状態を持つ
- 500系失敗時は `投稿詳細の取得に失敗しました` と `再試行` を表示
- `再試行` クリックで同一IDの再取得を実行

4. フォーカス復帰
- モーダル開閉トリガー（`自分の投稿一覧` ボタン）を `ref` で保持
- `閉じるボタン/Esc/背景クリック` で閉じた場合のみトリガーへ `focus()` を戻す
- 投稿クリックによる結果モーダル遷移時はフォーカス復帰対象外

---

## 4. 受入条件トレース（今回対象分）

- AC-01 投稿一覧表示（必須表示項目）: 3.2-1
- AC-02 投稿クリックで一覧閉→結果モーダル表示: 3.2-2
- AC-05 500時はID保持＋取得失敗表示: 3.2-3
- AC-10 失敗行の再試行: 3.2-3
- AC-09 のうちフォーカス復帰: 3.2-4

注記:
- エッジケース系（AC-06/07/08/11/12）は今回スコープ外として次フェーズで実施

---

## 5. 実装手順

1. `App.tsx` に一覧用詳細state（`postId -> detail/error/loading`）を追加
2. `openMyPosts` 時に表示対象IDの詳細取得を開始
3. 一覧行UIをID表示から詳細表示へ変更
4. 500失敗行に `再試行` ボタンを追加し再取得処理を接続
5. 投稿クリック処理を「クリック直後に一覧クローズ + 結果モーダルオープン」へ変更
6. トリガーボタン `ref` を追加し、明示的クローズ時のみフォーカス復帰

---

## 6. 検証手順（Green最小）

`frontend` で実行:

1. `npx vitest run src/features/top/__tests__/myPostDetail.integration.red.test.tsx src/features/top/__tests__/myPostAccessibility.red.test.tsx`
2. 必要に応じて関連既存テストをスポット実行
   - `npx vitest run src/features/top/__tests__/MyPostStorage.red.test.tsx src/features/top/__tests__/MyPostHighlight.red.test.tsx`

テストID対応:
- T-01/T-02: 一覧表示項目
- T-04: モーダル切替
- T-07/T-10: 500失敗表示と再試行
- T-12: フォーカス復帰

判定:
- 対象REDテストがすべてパスする
- 既存関連テストに致命的な回帰がない

---

## 7. 完了条件

- 対象REDテスト2ファイルがGreen化される
- Issue #74の今回対象受入条件（3章・4章記載分）を満たす
- 追加実装が最小範囲（`App.tsx` 中心）に留まる

---

## 8. コミット方針

コミットメッセージ案（Issue番号必須）:

`feat: E16-01 自分の投稿一覧のGreen最小実装 #74`

コミット本文案:
- 投稿一覧モーダルで投稿詳細の最小表示を追加
- 投稿クリック時に結果モーダルへ切替する動線を追加
- 500系失敗時の再試行導線とフォーカス復帰を追加
```
