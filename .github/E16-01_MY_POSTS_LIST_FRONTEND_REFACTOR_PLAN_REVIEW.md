- [重要度: 高]
- 問題点: 追加テスト観点に「同時3件まで並列取得」の仕様維持が含まれておらず、Refactor時に性能要件が後退しても検知できない。
- 改善提案: エッジケーステストへ「同時実行数が3件を超えない」検証を追加する。

- [重要度: 高]
- 問題点: `scripts/test_all.sh` 実行失敗時の対応方針が曖昧で、どの粒度で修正・再実行するか不明。
- 改善提案: 失敗時は「失敗テスト単体修正→対象スイート再実行→`scripts/test_all.sh` 再実行」の手順を明記する。

- [重要度: 中]
- 問題点: コメント追加方針はあるが、どの関数・分岐に付与するかが曖昧。
- 改善提案: `fetchMyPostDetailForList` / `handleMyPostClick` / `closeMyPosts` の3点に限定して明示する。

- [重要度: 中]
- 問題点: CodeRabbit指摘対応後に再レビューする手順が未記載で、修正の妥当性確認が不足する。
- 改善提案: 「修正後に `coderabbit review --plain` を再実行し、未対応指摘がないことを確認」を追加する。

- [重要度: 低]
- 問題点: コミット方針が単一コミット前提で、分割コミット時のIssue番号付与ルールが記載されていない。
- 改善提案: 分割時も全コミットタイトルに `#74` を付与するルールを追記する。

完全版:

```md
# REFACTOR計画書（改訂版）: E16-01 自分の投稿一覧（フロントエンド） #74

## 0. 目的

Green完了後のTDD Refactorフェーズとして、振る舞いを変更せずに可読性・保守性を改善する。

- 対象: `frontend/src/App.tsx` の自分の投稿一覧関連ロジック
- 目標: 既存テストを維持したまま、責務分離と可読性向上を実施

---

## 1. 制約

- 既存の振る舞いは変更しない（UI文言・遷移・保存仕様を維持）
- 既存テストはすべてパスし続けること
- 新規追加テストもすべてパスすること
- 過剰な再設計は行わない（段階的改善）

---

## 2. 改善スコープ

### 2.1 追加テスト（エッジケース）
- `my_post_ids` が `[]` のときに不要な詳細取得APIが呼ばれない
- 一覧オープン中に同一IDの再取得が重複しない
- `404` と `500` で一覧側の表示・保存挙動が維持される
- フォーカス復帰が明示クローズ時のみ発火する
- 一覧表示時の詳細取得で同時実行数が3件を超えない

### 2.2 コード改善
- マジックナンバーの定数化（再試行文言や表示制御に関する固定値）
- 長い `handleMyPostClick` の責務分割
  - 一覧側詳細取得
  - 成功時遷移
  - エラー時処理
- 重複処理の共通化
  - 非404時の復元処理
  - 詳細state更新処理
- 使われていないstate/処理の削除を確認

### 2.3 コメント追加
- `fetchMyPostDetailForList`: 非同期競合回避（`inFlightPostIdsRef`）の意図
- `handleMyPostClick`: `404` と非`404`で挙動を分ける理由
- `closeMyPosts`: フォーカス復帰対象を明示クローズに限定する理由

---

## 3. 実装方針

1. `App.tsx` に一覧詳細取得ヘルパーを切り出す
2. クリックハンドラを早期return中心に整理して分岐を浅くする
3. 定数とヘルパーをファイル先頭へ集約して可読性を上げる
4. 複雑分岐の直前に日本語コメントを追記する
5. 振る舞い差分が出ないことをテストで担保する

---

## 4. 検証手順

1. 追加/既存の対象テスト実行
   - `cd frontend`
   - `npx vitest run src/features/top/__tests__/myPostDetail.integration.red.test.tsx src/features/top/__tests__/myPostAccessibility.red.test.tsx src/features/top/__tests__/MyPostStorage.red.test.tsx src/features/top/__tests__/MyPostHighlight.red.test.tsx`
2. リポジトリ全体検証
   - `bash scripts/test_all.sh`
3. CodeRabbit自動レビュー
   - `coderabbit review --plain`
4. 指摘があれば最小修正して 1-3 を再実行
5. `scripts/test_all.sh` 失敗時は以下の順で復旧
   - 失敗テスト単体を修正
   - 関連スイートを再実行
   - `bash scripts/test_all.sh` を再実行
6. CodeRabbit指摘修正後は `coderabbit review --plain` を再実行し、未対応指摘がないことを確認

---

## 5. 完了条件

- 追加したエッジケーステストがすべてパス
- 既存テストがすべてパス
- `bash scripts/test_all.sh` が成功
- `coderabbit review --plain` の指摘に対応済み
- 振る舞い変更なしを確認

---

## 6. コミット方針

コミットメッセージ（CLAUDE.md準拠）:

`refactor: E16-01 投稿一覧ロジックを整理 #74`

コミット本文:
- エッジケーステストを追加
- マジックナンバーを定数化
- 複雑ロジックへ日本語コメントを追加
- 挙動を変えずに可読性と保守性を改善

補足:
- 分割コミット時も全コミットタイトル末尾に `#74` を付与する
```
