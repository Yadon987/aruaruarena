---
name: 仕様策定 (Spec)
about: 新機能や改善の仕様を定義する際に使用 (SDD/TDD/BDD準拠)
title: '[SPEC] E04-02: Tailwind CSSの導入と設定'
labels: 'spec, E04, frontend'
assignees: ''
---

## 📋 概要

フロントエンドプロジェクト（React + Vite + TypeScript）にTailwind CSSを導入し、効率的なスタイリング環境を構築する。

## 🎯 目的

- **効率的なCSS開発**: ユーティリティファーストのCSSフレームワークにより、クラス名ベースで迅速なスタイリングを実現
- **レスポンシブ対応**: モバイルファーストのレスポンシブデザインを容易に実装
- **デザインシステムの一貫性**: カラーパレット、スペース、タイポグラフィなどの統一感を確保
- **パフォーマンス**: 未使用CSSのパージ（Purge）により、バンドルサイズを最小化

---

## 📊 メタ情報

| 項目 | 値 |
|------|-----|
| 優先度 | P0（最優先） |
| 影響範囲 | 新機能（フロントエンド基盤） |
| 想定リリース | Sprint 1 / v0.1.0 |
| 担当者 | @username |
| レビュアー | @username |
| 見積もり工数 | 2h |

---

## 📝 詳細仕様

### 機能要件

- Tailwind CSS v3（最新安定版）の導入（`^3.4.x`を使用）
  - ※ v4は破壊的変更が多いため、エコシステムが安定しているv3系を採用します。
- PostCSS設定ファイルの作成（`postcss.config.js`）
- Tailwind CSS設定ファイルの作成（`tailwind.config.js`）
- ベースCSSファイルの作成（`src/index.css`）
- カスタムテーマ設定:
  - カラーパレット:
    - プライマリ: `#3B82F6` (blue-500相当)
    - セカンダリ: `#10B981` (emerald-500相当)
    - エラー: `#EF4444` (red-500相当)
  - フォントファミリー
  - スペーススケール
  - ブレークポイント（必要に応じてカスタマイズ）
- Viteプラグイン`@vitejs/plugin-react-swc`との統合

### 非機能要件

- **パフォーマンス**: 本番ビルド時に未使用CSSを自動削除（PurgeCSS）
- **開発体験**: HMR（Hot Module Replacement）対応、クラス名の自動補完
- **ブラウザサポート**: モダンブラウザ（Chrome, Firefox, Safari, Edge最新版）
- **バンドルサイズ**: 最適化後のCSSサイズを100KB以下に抑える
  - 測定コマンド: `npm run build && ls -lh dist/assets/*.css`

### 国際化対応（i18n）

- [x] エラーメッセージのi18n対応（該当なし）
- [x] 日時フォーマットのタイムゾーン考慮（該当なし）
- [x] 文字エンコーディング（UTF-8）の確認
- 対応言語: 日本語優先、将来英語対応予定

### UI/UX設計

- **デザインシステム**: Tailwindのデフォルトテーマをベースに、あるあるアリーナブランドに合わせてカスタマイズ
- **ダークモード対応**: 将来の拡張を考慮し、`darkMode: 'class'`戦略を採用
  - 関連Issue: #E04-XX: ダークモード対応（予定）
- **アクセシビリティ**: フォーカスリング、コントラスト比などを考慮

---

## 🗺️ Example Mapping（ルールと具体例）

| ルール | Given（前提条件） | When（操作） | Then（期待結果） |
|--------|------------------|-------------|-----------------|
| Tailwind CSSが導入されている | Viteプロジェクトが作成されている | `npm install`完了後、`npm run dev`を実行 | 開発サーバーがエラーなく起動する |
| Tailwindクラスが適用できる | Reactコンポーネントがある | `className="text-blue-500 font-bold"`を追加 | スタイルが正しく反映される |
| Safariで正しく表示される | macOS Safari最新版 | Tailwindクラス適用済のページを表示 | Chromeと同様に正しく表示される |
| レスポンシブユーティリティが動作 | 画面幅が640px以下 | `md:text-lg`クラスを適用 | 画面幅に応じてフォントサイズが変化する |
| カスタムカラーが使用できる | `tailwind.config.js`にカラーパレット定義 | `className="bg-primary-500"`を使用 | カスタムカラー（#3B82F6）が適用される |
| 未使用CSSがパージされる | 本番ビルドを実行 | `npm run build`を実行 | dist/に出力されるCSSが最適化されている（100KB以下） |

---

## 🔧 技術仕様

### データモデル (DynamoDB)

該当なし（フロントエンドのみの変更）

### 後方互換性

- [x] 既存APIのレスポンス形式を変更しない（該当なし）
- [x] 既存のクライアント（フロントエンド）への影響なし（新規プロジェクト）
- [x] データマイグレーション不要
- 破壊的変更がある場合の対応策: なし

### API設計

該当なし（フロントエンドのみの変更）

### エラーハンドリング仕様

該当なし（フロントエンドのみの変更）

### セキュリティ仕様

#### 認証・認可

- 認証方式: なし（CSSフレームワークのみ）
- 必要な権限レベル: なし
- 権限チェックのタイミング: なし

#### バリデーション

- 入力値検証ルール: なし（スタイリングのみ）
  - [x] 文字数制限
  - [x] 形式チェック（正規表現）
  - [x] サニタイズ処理
  - [x] ホワイトリスト/ブラックリスト

#### レート制限

- 制限対象: なし
- 制限値: -
- 制限期間: -
- 制限超過時の挙動: -

#### STRIDE脅威対策

- [x] Spoofing（なりすまし）対策: 該当なし
- [x] Tampering（改ざん）対策: 該当なし
- [x] Repudiation（否認）対策: 該当なし
- [x] Information Disclosure（情報漏洩）対策:
  - `tailwind.config.js`にAPIキーなどの機密情報を記述しない
  - CDN URLやプラグインバージョンは`package.json`等で管理し、ハードコードを避ける
- [x] Denial of Service（サービス拒否）対策: 該当なし
- [x] Elevation of Privilege（権限昇格）対策: 該当なし

### データ保持・プライバシー

- データ保持期間: なし（クライアントサイドのみ）
- 個人情報の取り扱い: なし
  - [x] GDPR/個人情報保護法への準拠確認
  - [x] 削除リクエスト対応の必要性
- ログからの個人情報マスキング: 該当なし

### パフォーマンス要件

#### N+1クエリ対策

- [x] includes/preload/eager_loadの使用箇所: 該当なし（フロントエンド）
- [x] 対象のアソシエーション: -

#### DynamoDB最適化

- [x] バッチ処理の使用: -
- [x] キャッシュ戦略: -
- [x] 読み込み整合性: -

#### 想定負荷

- 想定リクエスト数: -
- レスポンスタイム目標:
  - HMRによる更新は100ms以内
  - 測定方法: ブラウザDevToolsのNetworkタブまたは`vite --debug`ログで確認

### 障害復旧・耐障害性

- SLO目標:
  - 可用性: 99.x%（該当なし）
  - レイテンシ: p99 < Xms（該当なし）
- 障害発生時の挙動:
  - [x] グレースフルデグラデーション
  - [x] サーキットブレーカー
  - [x] リトライ戦略
- 復旧手順: -

### 外部API連携仕様

該当なし（フロントエンドのみの変更）

### トランザクション設計

該当なし（フロントエンドのみの変更）

### 並行処理・競合制御

- 競合が発生するケース: なし
- 競合制御の方法: -
- ロック戦略: -

### ログ出力仕様

該当なし（フロントエンドのみの変更）

### モニタリング・アラート

- 監視メトリクス:
  - [x] レスポンスタイム
  - [x] エラー率
  - [x] レート制限超過回数
  - [x] 外部API呼び出し失敗率
- アラート条件: -
- アラート通知先: -

### 分散トレーシング

- [x] トレースIDの伝播
- スパンの定義:
  - スパン名: -
  - 含める属性: -

### カスタムメトリクス

該当なし

### AIプロンプト設計

該当なし

---

## 🚫 実装時の禁止事項チェックリスト

実装時に以下を遵守すること：
- [x] `.permit!` を使用していない（バックエンドのみ）
- [x] N+1クエリが発生しない（バックエンドのみ）
- [x] トランザクションなしで複数DB操作していない（バックエンドのみ）
- [x] 機密情報（APIキー、パスワード）をハードコードしていない
- [ ] **テストなしで機能を実装していない**（スタイル確認用の簡易テストを作成）
- [x] `binding.pry` を本番コードに残していない
- [x] コメント・コミットメッセージは日本語で記述

---

## 🧪 テスト計画 (TDD)

### Unit Test (Model/Service)

該当なし（フロントエンドのみの変更）

### Request Spec (API)

該当なし（フロントエンドのみの変更）

### Integration Test (結合テスト)

- [x] 外部サービスとの連携テスト: 該当なし
- [ ] **E2Eシナリオ**:
  - 開発サーバー起動確認: `npm run dev` で起動すること
  - Class適用確認: `App.tsx`に`<div className="text-red-500">Test</div>`を追加し、文字色が赤になることを目視確認
  - ビルド確認: `npm run build` が成功すること

### External Service (WebMock/VCR)

- [x] モック対象: なし

### Performance Test (負荷テスト)

- [x] 負荷テストシナリオ: 該当なし
- [x] 目標スループット: -
- [x] 目標レイテンシ: -

### カバレッジ目標

- [ ] **カバレッジ90%以上を達成**: 該当なし（スタイル設定のみ）

**フロントエンド検証用チェックリスト**:
- [ ] 開発サーバーがエラーなく起動する（`npm run dev`）
- [ ] Tailwindクラスが適用される（`App.tsx`での視覚確認）
- [ ] 本番ビルドが成功する（`npm run build`）
- [ ] CSSが最適化されている
  - 確認コマンド: `ls -lh dist/assets/*.css` でサイズを確認（100KB以下目標）

---

## ✅ 受入条件 (AC) - Given-When-Then

### 正常系 (Happy Path)

- [ ] **Given** Viteプロジェクトが作成されている（E04-01完了）
      **When** Tailwind CSSのインストールと設定が完了している
      **Then** 開発サーバー（`npm run dev`）がエラーなく起動し、Tailwindクラスが適用される

- [ ] **Given** Reactコンポーネントがある
      **When** Tailwindユーティリティクラスを`className`に追加する
      **Then** スタイルが正しく反映される

- [ ] **Given** カスタムテーマが設定されている
      **When** `tailwind.config.js`で定義したカスタムカラーを使用する
      **Then** カスタムカラーが適用される

- [ ] **Given** 本番ビルドを実行する
      **When** `npm run build`を実行する
      **Then** 未使用のTailwindクラスがパージされ、最適化されたCSSが出力される

### 異常系 (Error Path)

- [ ] **Given** Tailwind設定ファイルに構文エラーがある
      **When** 開発サーバーを起動する
      **Then** 適切なエラーメッセージが表示され、ビルドが失敗する

- [ ] **Given** PostCSS設定が正しくない
      **When** 本番ビルドを実行する
      **Then** ビルドエラーが発生し、問題箇所が特定できる

### 境界値 (Edge Case)

- [ ] **Given** 画面幅がブレークポイント境界（640px, 768px, 1024px, 1280px）
      **When** レスポンシブクラス（`sm:`, `md:`, `lg:`, `xl:`）を使用する
      **Then** 正しいブレークポイントでスタイルが切り替わる

---

## 🚀 リリース計画

### フィーチャーフラグ

- フラグ名: なし（CSSフレームワークのみ）
- デフォルト値: -
- 有効化条件: -
- 完全有効化後の削除予定: -

### マイグレーション計画

- 既存データへの影響: なし（フロントエンドのみ）
- マイグレーションスクリプト: なし
- ロールバック手順: `git checkout`で設定ファイルを戻す

### ロールアウト戦略

- リリース方法: 即時適用（フロントエンドのみ）
- ロールバック条件: Tailwind導入による既存スタイルへの悪影響
- 緊急停止手順: `tailwind.config.js`と`postcss.config.js`を削除し、`package.json`からTailwind関連を削除

### ドキュメント更新

- [x] API仕様書（OpenAPI/Swagger）の更新: 該当なし
- [ ] **README.mdの更新**: Tailwind使用方法とカスタムテーマを記載
- [x] 運用手順書の更新: 該当なし
- [x] ユーザー向けヘルプの更新: 該当なし

### 依存関係

- 前提条件となるIssue: #E04-01（Viteプロジェクトの作成）✅ 完了
- ブロッカーとなるIssue: なし
- 関連するIssue: #E04-03（ESLint / Prettier の設定）

---

## 🔗 関連資料

- Tailwind CSS公式ドキュメント: https://tailwindcss.com/docs
- Vite + Tailwind CSS セットアップガイド: https://tailwindcss.com/docs/guides/vite
- PostCSSドキュメント: https://postcss.org/

---

## 📊 Phase 2完了チェック（技術設計確定）

- [x] AIとの壁打ち設計を完了
- [x] 設計レビューを実施
- [x] 全ての不明点を解決
- [x] このIssueに技術仕様を書き戻し完了

---

**レビュアーへの確認事項:**

- [ ] 仕様の目的が明確か
- [x] DynamoDBのキー設計はアクセスパターンに適しているか（該当なし）
- [ ] Example Mappingでルールと例が網羅されているか
- [x] セキュリティ要件（認証、認可、バリデーション、レート制限）が明確か（該当なし）
- [x] エラーハンドリングが統一フォーマットに従っているか（該当なし）
- [x] N+1クエリ対策が考慮されているか（該当なし）
- [x] 外部API連携時のタイムアウト・リトライが設計されているか（該当なし）
- [x] トランザクション境界とロールバック戦略が明確か（該当なし）
- [ ] テスト計画は正常系/異常系/境界値を網羅しているか
- [ ] 受入条件はGiven-When-Then形式で記述されているか
- [x] ログ出力に機密情報が含まれていないか（該当なし）
- [ ] CLAUDE.mdの禁止事項を遵守しているか
- [x] 既存機能や他の仕様と矛盾していないか
- [x] 後方互換性が確保されているか（新規プロジェクト）
- [x] フィーチャーフラグによる段階的リリースが検討されているか（該当なし）
- [x] 障害復旧・耐障害性が考慮されているか（該当なし）
- [ ] ドキュメント更新計画があるか
- [ ] 見積もり工数は妥当か
