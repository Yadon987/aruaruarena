# レビュー結果: E15-01 Refactor計画書

レビュー対象: `.github/E15-01_RESULT_MODAL_UI_REFACTOR_PLAN.md`  
参照: `.github/ISSUE_TEMPLATE/Issue_review.md`, Issue `#64`

---

- [重要度: 高]
- 問題点  
  エッジケーステストの候補に `rank=0` を含めているが、仕様上 `rank` は順位であり 1 始まり前提の可能性が高い。仕様未定義値を通常ケースとして扱うと、振る舞い不変の前提を崩すリスクがある。
- 改善提案  
  `rank=0` は「仕様外入力の防御確認」として明示するか、今回のRefactor対象から外して `rank欠損` / `total_count欠損` に限定する。

- [重要度: 高]
- 問題点  
  「失敗確認」の基準が曖昧で、追加テストが RED であるべきか、既存実装で即 Green を許容するかが未定義。
- 改善提案  
  Refactorフェーズでは「先にテスト追加し、必要なら失敗確認後に最小修正」と明記し、必須条件は最終 Green であることを明確化する。

- [重要度: 中]
- 問題点  
  `scripts/test_all.sh` 実行時の失敗時対応が抽象的で、どの粒度で切り分けるか不明確。
- 改善提案  
  失敗時の切り分け順を記載する（対象テスト再実行 → ログ確認 → 最小修正 → 再実行）。

- [重要度: 中]
- 問題点  
  コメント追加方針はあるが、どのファイルのどのロジックに必須で入れるかが明記されていない。
- 改善提案  
  `App.tsx` の後勝ち制御、`ResultModal.tsx` のフォーカストラップを必須コメント箇所として固定する。

- [重要度: 低]
- 問題点  
  非機能観点（パフォーマンス/ログ）に触れていないため、Issue_review 観点 4 への回答が弱い。
- 改善提案  
  Refactorでは「不要な再レンダリング誘発処理の削減」「デバッグ容易性のためのエラー文脈整理」を対象に含める。

---

## 反映方針

1. `rank=0` の扱いを仕様外ケースとして注記  
2. Refactorフェーズのテスト追加運用を明文化  
3. `scripts/test_all.sh` 失敗時の切り分け手順を追加  
4. 必須コメント箇所を明示  
5. 非機能観点の最小改善項目を追記  
