# ğŸŸï¸ aruaruarenaï¼ˆã‚ã‚‹ã‚ã‚‹ã‚¢ãƒªãƒ¼ãƒŠï¼‰

**3äººã®AIå¯©æŸ»å“¡ãŒæ¡ç‚¹ã™ã‚‹ã€è¶…çŸ­æ–‡ã€Œã‚ã‚‹ã‚ã‚‹ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ãƒŸãƒ‹ã‚¢ãƒ—ãƒª**

[![CI/CD](https://github.com/yourusername/aruaruarena/workflows/CI/badge.svg)](https://github.com/yourusername/aruaruarena/actions)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

---

## ğŸ“– æ¦‚è¦

ã€Œã‚ã‚‹ã‚ã‚‹ã‚¢ãƒªãƒ¼ãƒŠï¼ˆaruaruarenaï¼‰ã€ã¯ã€èª°ã‚‚ãŒå…±æ„Ÿã§ãã‚‹ã€Œã‚ã‚‹ã‚ã‚‹ã€ã‚’**3ã€œ30æ–‡å­—**ã§æŠ•ç¨¿ã—ã€3äººã®AIå¯©æŸ»å“¡ï¼ˆã²ã‚ã‚†ãé¢¨ã€ãƒ‡ãƒ´ã‚£å©¦äººé¢¨ã€ä¸­å°¾å½¬é¢¨ï¼‰ãŒè‡ªå‹•æ¡ç‚¹ã™ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆå‹ãƒŸãƒ‹ã‚¢ãƒ—ãƒªã§ã™ã€‚

â€»æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç‰¹å®šã®äººç‰©ãƒ»ç•ªçµ„ãƒ»ä¼æ¥­ã¨ã¯ç„¡é–¢ä¿‚ã®ãƒ‘ãƒ­ãƒ‡ã‚£è¡¨ç¾ã‚’å«ã¿ã¾ã™ã€‚

### âœ¨ ç‰¹å¾´

- ğŸ¤– **AIå¯©æŸ»å“¡3äººã«ã‚ˆã‚‹è‡ªå‹•æ¡ç‚¹**
  - ã²ã‚ã‚†ãé¢¨ï¼ˆGemini Proï¼‰: è«–ç†çš„ã€å¦å®šçš„ã€ç‹¬å‰µæ€§é‡è¦–
  - ãƒ‡ãƒ´ã‚£å©¦äººé¢¨ï¼ˆGLM-4ï¼‰: ä¸Šå“ã€æ„Ÿæƒ…çš„ã€è¨€èªã‚»ãƒ³ã‚¹é‡è¦–
  - ä¸­å°¾å½¬é¢¨ï¼ˆGPT-4o-miniï¼‰: è±ªå¿«ã€å…±æ„Ÿçš„ã€ç·åˆçš„ãªç¬‘ã„é‡è¦–

- ğŸ“Š **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°**
  - TOP 50ãƒ©ãƒ³ã‚­ãƒ³ã‚°
  - è‡ªåˆ†ã®æŠ•ç¨¿ä½ç½®ã‚’å³åº§ã«ç¢ºèªå¯èƒ½

- ğŸ–¼ï¸ **å‹•çš„OGPç”»åƒç”Ÿæˆ**
  - å¯©æŸ»å®Œäº†æ™‚ã«OGPç”»åƒã‚’è‡ªå‹•ç”Ÿæˆ
  - SNSã‚·ã‚§ã‚¢æ™‚ã«æŠ•ç¨¿å†…å®¹ãƒ»ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º

- ğŸ¨ **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
  - å¯©æŸ»ä¸­ã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒå‹•ãï¼ˆFramer Motionï¼‰
  - ãƒ©ãƒ³ãƒ€ãƒ ã§å£ç™–ã‚’ç™ºè¨€

- ğŸ”’ **å®Œå…¨åŒ¿åæŠ•ç¨¿**
  - ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦
  - ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã®ã¿ã§å‚åŠ å¯èƒ½
  - è‡ªåˆ†ã®æŠ•ç¨¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆLocalStorageï¼‰ã§ç®¡ç†

---

## ğŸ¯ æŠ•ç¨¿ãƒ«ãƒ¼ãƒ«

### æŠ•ç¨¿å†…å®¹
- **æ–‡å­—æ•°**: 3ã€œ30æ–‡å­—ï¼ˆå³å®ˆï¼‰
- **çµµæ–‡å­—ã‚‚1æ–‡å­—ã¨ã—ã¦å³å¯†ã«ã‚«ã‚¦ãƒ³ãƒˆ**ï¼ˆUnicodeã®graphemeå˜ä½ï¼‰
- **å†…å®¹**: èª°ã‚‚ãŒå…±æ„Ÿã§ãã‚‹ã€Œã‚ã‚‹ã‚ã‚‹ã€
- **ä¾‹**:
  - ã€Œã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯ã€ï¼ˆ11æ–‡å­—ï¼‰
  - ã€Œå……é›»20%ã§ä¸å®‰ç™ºå‹•ã€ï¼ˆ11æ–‡å­—ï¼‰
  - ã€ŒWi-Fié…ã„æ™‚ã ã‘ãƒ«ãƒ¼ã‚¿ãƒ¼è§¦ã‚‹ã€ï¼ˆ17æ–‡å­—ï¼‰

### ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ 
- **æ–‡å­—æ•°**: 1ã€œ20æ–‡å­—
- **æ¨å¥¨**: 8æ–‡å­—ä»¥å†…ï¼ˆè¶…éåˆ†ã¯ä¸€è¦§ã§çœç•¥è¡¨ç¤ºï¼‰
- **é‡è¤‡**: OKï¼ˆæŠ•ç¨¿IDã§åŒºåˆ¥ï¼‰

### æŠ•ç¨¿åˆ¶é™ï¼ˆã‚¹ãƒ‘ãƒ å¯¾ç­–ï¼‰
- åŒä¸€IP: **5åˆ†ã«1å›**
- åŒä¸€ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ : **5åˆ†ã«1å›**
- åŒä¸€ãƒ†ã‚­ã‚¹ãƒˆ: 24æ™‚é–“ä»¥å†…ã«åŒã˜å†…å®¹ã¯æŠ•ç¨¿ä¸å¯

---

## ğŸ† æ¡ç‚¹åŸºæº–

å„å¯©æŸ»å“¡ãŒ5é …ç›®Ã—20ç‚¹æº€ç‚¹ã§æ¡ç‚¹ï¼ˆåˆè¨ˆ100ç‚¹æº€ç‚¹ï¼‰

| é …ç›® | é…ç‚¹ | èª¬æ˜ |
|-----|------|------|
| **å…±æ„Ÿåº¦** | 20ç‚¹ | ã©ã‚Œã ã‘å¤šãã®äººãŒå…±æ„Ÿã§ãã‚‹ã‹ |
| **é¢ç™½ã•** | 20ç‚¹ | ç¬‘ãˆã‚‹ã€ã‚¯ã‚¹ãƒƒã¨ãã‚‹ |
| **ç°¡æ½”ã•** | 20ç‚¹ | çŸ­ãã‚·ãƒ³ãƒ—ãƒ«ã«è¡¨ç¾ã§ãã¦ã„ã‚‹ã‹ |
| **ç‹¬å‰µæ€§** | 20ç‚¹ | ä»–ã«ãªã„è¦–ç‚¹ã€æ–°ã—ã„ç™ºè¦‹ |
| **è¡¨ç¾åŠ›** | 20ç‚¹ | è¨€è‘‰ã®é¸ã³æ–¹ã€èªæ„Ÿ |

### å¯©æŸ»å“¡ã®æ¡ç‚¹ãƒã‚¤ã‚¢ã‚¹

| å¯©æŸ»å“¡ | é‡è¦–é …ç›® | æ€§æ ¼ |
|-------|---------|------|
| **ã²ã‚ã‚†ãé¢¨** | ç‹¬å‰µæ€§(+3)ã€å…±æ„Ÿåº¦(-2) | ã€Œãã‚Œã£ã¦æœ¬å½“ï¼Ÿã€ã¨ç–‘ã† |
| **ãƒ‡ãƒ´ã‚£å©¦äººé¢¨** | è¡¨ç¾åŠ›(+3)ã€é¢ç™½ã•(+2) | ã€Œå“ãŒã‚ã‚‹ã€ã‚’é‡è¦– |
| **ä¸­å°¾å½¬é¢¨** | é¢ç™½ã•(+3)ã€å…±æ„Ÿåº¦(+2) | ã€Œã‚ã‹ã‚‹ã‚ã‹ã‚‹ï¼ã€ã¨å…±æ„Ÿ |

### å¹³å‡ç‚¹ã®è¨ˆç®—
- 3äººæˆåŠŸ: 3äººã®å¹³å‡ç‚¹ï¼ˆå°æ•°ç¬¬1ä½ï¼‰
- 2äººæˆåŠŸ: 2äººã®å¹³å‡ç‚¹
- 1äººä»¥ä¸‹: å¯©æŸ»å¤±æ•—ã€å†å¯©æŸ»ãƒœã‚¿ãƒ³è¡¨ç¤º
- å†å¯©æŸ»: **å¤±æ•—ã—ãŸå¯©æŸ»å“¡ã®ã¿å†å®Ÿè¡Œ**ï¼ˆã‚³ã‚¹ãƒˆæœ€å°åŒ–ï¼‰

### ãƒ©ãƒ³ã‚­ãƒ³ã‚°åŒç‚¹ãƒ«ãƒ¼ãƒ«
- åŒç‚¹ã®å ´åˆ: **æ—©ã„æŠ•ç¨¿ãŒä¸Šä½**

---

## ğŸ–¼ï¸ OGPç”»åƒç”Ÿæˆ

### æ¦‚è¦
SNSã§ã‚·ã‚§ã‚¢ã•ã‚ŒãŸéš›ã«ã€æŠ•ç¨¿å†…å®¹ã¨ã‚¹ã‚³ã‚¢ã‚’å«ã‚€å‹•çš„ãªOGPç”»åƒã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### æˆ¦ç•¥: ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—æ–¹å¼
å¯©æŸ»å®Œäº†æ™‚ã«OGPç”»åƒã‚’äº‹å‰ç”Ÿæˆã—ã€CloudFrontã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

```
å¯©æŸ»å®Œäº† â†’ Rubyã‚¹ãƒ¬ãƒƒãƒ‰ã§OGP URLã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ CloudFrontãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ â†’ SNSã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã¯é«˜é€Ÿå–å¾—
```

### ãƒ•ãƒ­ãƒ¼
1. **å¯©æŸ»å®Œäº†**: `status` ãŒ `scored` ã«å¤‰æ›´
2. **ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—**: `Thread.new` ã§è‡ªèº«ã®OGP URLã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæœ€å¤§0.5ç§’å¾…æ©Ÿï¼‰
3. **ç”»åƒç”Ÿæˆ**: `mini_magick` ã§ãƒ™ãƒ¼ã‚¹ç”»åƒã«ãƒ†ã‚­ã‚¹ãƒˆåˆæˆ
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: CloudFrontãŒ1é€±é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
5. **SNSã‚·ã‚§ã‚¢**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿ç”»åƒã‚’å³åº§ã«é…ä¿¡

### å®Ÿè£…ä¾‹
```ruby
# app/models/post.rb
def warm_ogp_cache
  thread = Thread.new do
    uri = URI("https://api.example.com/ogp/posts/#{id}.png")
    Net::HTTP.get(uri)
  rescue => e
    Rails.logger.warn("OGP warmup failed: #{e.message}")
  end
  thread.join(0.5)  # æœ€å¤§0.5ç§’ã ã‘å¾…ã¤ï¼ˆLambdaç’°å¢ƒå¯¾ç­–ï¼‰
end
```

### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… è¿½åŠ ã‚³ã‚¹ãƒˆãªã—ï¼ˆS3ä¿å­˜ä¸è¦ï¼‰
- âœ… ã‚¤ãƒ³ãƒ•ãƒ©è¿½åŠ ãªã—ï¼ˆSQS/Jobä¸è¦ï¼‰
- âœ… SNSã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå›é¿

---

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Backend
- **Ruby 3.2.2** + **Rails 8.0 (API mode)**
- **DynamoDB** (NoSQLã€ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰)
- **AWS Lambda** (Dockerã‚³ãƒ³ãƒ†ãƒŠãƒ‡ãƒ—ãƒ­ã‚¤)
- **API Gateway** (HTTP API)
- **mini_magick** (å‹•çš„OGPç”»åƒç”Ÿæˆ)
- **RSpec** (ãƒ†ã‚¹ãƒˆ)

### Frontend
- **React 18** + **TypeScript**
- **Vite** (ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«)
- **Framer Motion** (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
- **TanStack Query** (ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥)
- **Tailwind CSS** (ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°)
- **Playwright** (E2Eãƒ†ã‚¹ãƒˆ)

### AI APIs
- **Gemini Pro** (Google) - ã²ã‚ã‚†ãé¢¨
- **GLM-4** (Zhipu AI) - ãƒ‡ãƒ´ã‚£å©¦äººé¢¨
- **GPT-4o-mini** (OpenAI) - ä¸­å°¾å½¬é¢¨

### Infrastructure
- **Terraform** (IaC)
- **AWS CloudFront** (CDN + OGPã‚­ãƒ£ãƒƒã‚·ãƒ¥)
- **AWS S3** (é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°)
- **AWS EventBridge** (ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—)
- **GitHub Actions** (CI/CD)

### Analytics
- **Google Analytics 4** (è¨ªå•è€…åˆ†æ)

---

## ğŸ—ï¸ ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆå›³

```mermaid
graph TB
    subgraph "ãƒ¦ãƒ¼ã‚¶ãƒ¼"
        Browser[ãƒ–ãƒ©ã‚¦ã‚¶]
    end

    subgraph "Frontend (React + Vite)"
        ReactApp[React SPA<br/>- Framer Motion<br/>- React Query<br/>- Tailwind CSS]
    end

    subgraph "AWS CloudFront + S3"
        CloudFront[CloudFront<br/>CDN + OGPã‚­ãƒ£ãƒƒã‚·ãƒ¥]
        S3Static[S3 Bucket<br/>é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°]
    end

    subgraph "AWS API Gateway"
        APIGateway[HTTP API<br/>REST Endpoint]
    end

    subgraph "AWS Lambda (Container)"
        Lambda[Lambda Function<br/>Ruby 3.2 + Rails 8.0 API<br/>- Dynamoid<br/>- AI Judge Service<br/>- OGP Generator]
    end

    subgraph "AWS DynamoDB"
        DynamoPosts[(posts<br/>ãƒ†ãƒ¼ãƒ–ãƒ«)]
        DynamoJudgements[(judgements<br/>ãƒ†ãƒ¼ãƒ–ãƒ«)]
        DynamoRateLimits[(rate_limits<br/>ãƒ†ãƒ¼ãƒ–ãƒ«)]
        DynamoDuplicateChecks[(duplicate_checks<br/>ãƒ†ãƒ¼ãƒ–ãƒ«)]
    end

    subgraph "AI APIs"
        Gemini[Google Gemini Pro<br/>ã²ã‚ã‚†ãé¢¨]
        GLM4[Zhipu GLM-4<br/>ãƒ‡ãƒ´ã‚£å©¦äººé¢¨]
        GPT[OpenAI GPT-4o-mini<br/>ä¸­å°¾å½¬é¢¨]
    end

    subgraph "ç›£è¦–ãƒ»ãƒ­ã‚°"
        CloudWatch[CloudWatch<br/>- Logs<br/>- Alarms<br/>- Budget Alert]
    end

    subgraph "ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—"
        EventBridge[EventBridge<br/>5åˆ†ã”ã¨]
    end

    subgraph "CI/CD"
        GitHub[GitHub Actions<br/>- CI Test<br/>- Deploy]
        ECR[Amazon ECR<br/>Lambdaã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸]
    end

    subgraph "Analytics"
        GA4[Google Analytics 4<br/>è¨ªå•è€…åˆ†æ]
    end

    %% ãƒ•ãƒ­ãƒ¼
    Browser -->|HTTPS| CloudFront
    CloudFront --> S3Static
    S3Static --> ReactApp
    Browser -->|ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼| GA4
    
    ReactApp -->|API Request| APIGateway
    APIGateway --> Lambda
    
    Lambda --> DynamoPosts
    Lambda --> DynamoJudgements
    Lambda --> DynamoRateLimits
    Lambda --> DynamoDuplicateChecks
    
    Lambda -.->|ä¸¦åˆ—å¯©æŸ»| Gemini
    Lambda -.->|ä¸¦åˆ—å¯©æŸ»| GLM4
    Lambda -.->|ä¸¦åˆ—å¯©æŸ»| GPT
    
    Lambda --> CloudWatch
    EventBridge -->|Warmup Ping| Lambda
    
    GitHub -->|Build & Push| ECR
    ECR -->|Deploy| Lambda
    GitHub -->|Deploy Static| S3Static
    
    style Browser fill:#e1f5ff
    style ReactApp fill:#61dafb
    style Lambda fill:#ff9900
    style DynamoPosts fill:#4053d6
    style DynamoJudgements fill:#4053d6
    style DynamoRateLimits fill:#4053d6
    style DynamoDuplicateChecks fill:#4053d6
    style Gemini fill:#4285f4
    style GLM4 fill:#00d4aa
    style GPT fill:#10a37f
    style CloudWatch fill:#ff9900
    style GA4 fill:#e37400
```

---

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
aruaruarena/
â”œâ”€â”€ backend/                  # Rails API
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚   â”‚       â”œâ”€â”€ posts_controller.rb
â”‚   â”‚   â”‚       â”œâ”€â”€ rankings_controller.rb
â”‚   â”‚   â”‚       â””â”€â”€ ogp_controller.rb
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ post.rb
â”‚   â”‚   â”‚   â””â”€â”€ judgement.rb
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_judge_service.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_service.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ glm_service.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_service.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ spam_detector.rb
â”‚   â”‚   â”‚   â”œâ”€â”€ rate_limiter.rb
â”‚   â”‚   â”‚   â””â”€â”€ ogp_generator.rb
â”‚   â”‚   â””â”€â”€ lambda.rb
â”‚   â”œâ”€â”€ spec/
â”‚   â”œâ”€â”€ Gemfile
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ dynamoid.rb
â”‚       â””â”€â”€ routes.rb
â”‚
â”œâ”€â”€ frontend/                 # React SPA
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ PostForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RankingList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ JudgePanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PrivacyPolicy.tsx
â”‚   â”‚   â”‚   â””â”€â”€ avatars/
â”‚   â”‚   â”‚       â”œâ”€â”€ HiroyukiAvatar.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ DewiAvatar.tsx
â”‚   â”‚   â”‚       â””â”€â”€ NakaoAvatar.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ usePost.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useRanking.ts
â”‚   â”‚   â”‚   â””â”€â”€ useLocalStorage.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ graphemeLength.ts
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ terraform/                # ã‚¤ãƒ³ãƒ•ãƒ©
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ dynamodb.tf
â”‚   â”œâ”€â”€ lambda.tf
â”‚   â”œâ”€â”€ s3.tf
â”‚   â”œâ”€â”€ cloudfront.tf
â”‚   â”œâ”€â”€ api_gateway.tf
â”‚   â”œâ”€â”€ warmup.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â””â”€â”€ outputs.tf
â”‚
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ ci.yml
â”‚   â””â”€â”€ deploy.yml
â”‚
â”œâ”€â”€ doc/
â”‚   â””â”€â”€ db_code.md            # DBè¨­è¨ˆæ›¸
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶
- Node.js 18+
- Ruby 3.2.2
- Docker & Docker Compose
- AWS CLI
- Terraform 1.6+
- ImageMagickï¼ˆOGPç”»åƒç”Ÿæˆç”¨ï¼‰

### API Keysï¼ˆå¿…é ˆï¼‰
- Gemini API Key (Google AI Studio)
- GLM-4 API Key (Zhipu AI)
- OpenAI API Key

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/yourusername/aruaruarena.git
cd aruaruarena
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cp .env.example .env
# .envã‚’ç·¨é›†ã—ã¦API Keyã‚’è¨­å®š
```

**.env.example**
```env
# Common
APP_ENV=development
AWS_REGION=ap-northeast-1

# DynamoDB
DYNAMODB_TABLE_POSTS=aruaruarena-posts
DYNAMODB_TABLE_JUDGEMENTS=aruaruarena-judgements
DYNAMODB_TABLE_RATE_LIMITS=aruaruarena-rate-limits
DYNAMODB_TABLE_DUPLICATE_CHECKS=aruaruarena-duplicate-checks
DYNAMODB_ENDPOINT=http://localhost:8000

# AI APIs
GEMINI_API_KEY=your-gemini-key
GLM_API_KEY=your-glm-key
OPENAI_API_KEY=your-openai-key

# Frontend
REACT_APP_API_URL=http://localhost:3000/api
REACT_APP_GA_MEASUREMENT_ID=G-XXXXXXXXXX
```

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd backend
bundle install

# DynamoDB Localã‚’èµ·å‹•
docker-compose up -d

# ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
bundle exec rails dynamoid:create_tables

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
bundle exec rails s
```

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd frontend
npm install
npm run dev
# â†’ http://localhost:5173
```

### 5. ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
cd backend
bundle exec rspec

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
cd frontend
npm test
npm run test:e2e  # Playwright E2E
```

---

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. AWSã‚¤ãƒ³ãƒ•ãƒ©ã®æ§‹ç¯‰

```bash
cd terraform
terraform init
terraform plan
terraform apply
```

### 2. GitHub Secretsè¨­å®š

ãƒªãƒã‚¸ãƒˆãƒªã® Settings > Secrets ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `GEMINI_API_KEY`
- `GLM_API_KEY`
- `OPENAI_API_KEY`

### 3. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

`main` ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆGitHub Actionsï¼‰

---

## ğŸ“¡ APIä»•æ§˜

### POST /api/posts
ã‚ã‚‹ã‚ã‚‹ã‚’æŠ•ç¨¿

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "nickname": "å¤ªéƒ",
  "body": "ã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "judging"
}
```

### GET /api/posts/:id
æŠ•ç¨¿è©³ç´°ã¨å¯©æŸ»çŠ¶æ³

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "550e8400-...",
  "nickname": "å¤ªéƒ",
  "body": "ã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯",
  "average_score": 85.3,
  "rank": 12,
  "total_count": 500,
  "judgements": [
    {
      "persona": "hiroyuki",
      "total_score": 82,
      "empathy": 14,
      "humor": 17,
      "brevity": 18,
      "originality": 19,
      "expression": 14,
      "comment": "ãã‚Œã£ã¦æœ¬å½“ã«ã‚ã‚‹ã‚ã‚‹ã§ã™ã‹ï¼Ÿ",
      "success": true
    },
    {
      "persona": "dewi",
      "total_score": 90,
      "comment": "ã¾ãã€å…±æ„Ÿã§ãã‚‹ã‚ï¼",
      "success": true
    },
    {
      "persona": "nakao",
      "total_score": 84,
      "comment": "ã‚ã‹ã‚‹ã‚ã‹ã‚‹ï¼",
      "success": true
    }
  ]
}
```

### GET /api/rankings
ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—ï¼ˆTOP50ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "rankings": [
    {
      "rank": 1,
      "id": "aaa-111",
      "nickname": "å¤ªéƒ",
      "body": "ã‚¹ãƒŒãƒ¼ã‚ºæŠ¼ã—ã¦äºŒåº¦å¯",
      "average_score": 95.3
    }
  ],
  "total_count": 500
}
```

### GET /api/my-rank/:id
è‡ªåˆ†ã®é †ä½ç¢ºèª

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "rank": 123,
  "total_count": 500,
  "post": { /* ... */ }
}
```

### POST /api/posts/:id/rejudge
å¤±æ•—ã—ãŸå¯©æŸ»å“¡ã®å†å¯©æŸ»

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "failed_personas": ["dewi"]
}
```

### GET /ogp/posts/:id.png
å‹•çš„OGPç”»åƒå–å¾—

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

è©³ç´°ã¯ [doc/db_code.md](doc/db_code.md) ã‚’å‚ç…§ã€‚

### posts ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§ | å‹ | èª¬æ˜ |
|-----|---|------|
| id | String | UUID (Primary Key) |
| nickname | String | 1-20æ–‡å­— |
| body | String | 3-30æ–‡å­—ï¼ˆgraphemeï¼‰ |
| average_score | Number | å°æ•°ç¬¬1ä½ï¼ˆä¾‹: 87.3ï¼‰ |
| judges_count | Number | æˆåŠŸã—ãŸå¯©æŸ»å“¡æ•°ï¼ˆ0-3ï¼‰ |
| status | String | judging / scored / failed |
| score_key | String | GSI SK (ã‚¹ã‚³ã‚¢é™é † + ä½œæˆæ—¥æ™‚æ˜‡é †) |
| status | String | GSI PK (`scored` ã®å ´åˆã®ã¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã•ã‚Œã‚‹) |

**GSI: RankingIndex**
- Partition Key: `status`
- Sort Key: `score_key`
- ç”¨é€”: TOP50ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾— (`ScanIndexForward=false` / ã‚¹ãƒ‘ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)

### judgements ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§ | å‹ | èª¬æ˜ |
|-----|---|------|
| post_id | String | Partition Key |
| persona | String | Sort Key: hiroyuki / dewi / nakao (ä¸Šæ›¸ãå‹) |
| id | String | UUID (ãƒ­ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨) |
| succeeded | Boolean | APIæˆåŠŸ/å¤±æ•— (App default: false) |
| error_code | String | å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ |
| empathy, humor, brevity, originality, expression | Number | å„0-20ç‚¹ï¼ˆå¤±æ•—æ™‚ã¯NULLï¼‰ |
| total_score | Number | 0-100ç‚¹ï¼ˆå¤±æ•—æ™‚ã¯NULLï¼‰ |
| comment | String | å¯©æŸ»ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå¤±æ•—æ™‚ã¯NULLï¼‰ |
| judged_at | Number | æœ€çµ‚å¯©æŸ»æ—¥æ™‚ (UnixTimestamp) |

> **Note:** å†å¯©æŸ»æ™‚ã¯åŒã˜ persona ã§ä¸Šæ›¸ãä¿å­˜ã€‚éå»å±¥æ­´ã¯ CloudWatch Logs ã§ç®¡ç†ã€‚

### rate_limits ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§ | å‹ | èª¬æ˜ |
|-----|---|------|
| identifier | String | Primary Key (`ip#hash` ã¾ãŸã¯ `nick#hash`) |
| expires_at | Number | TTLï¼ˆ5åˆ†å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰ |

### duplicate_checks ãƒ†ãƒ¼ãƒ–ãƒ«

| å±æ€§ | å‹ | èª¬æ˜ |
|-----|---|------|
| body_hash | String | Primary Keyï¼ˆæ­£è¦åŒ–å¾Œãƒãƒƒã‚·ãƒ¥ï¼‰ |
| expires_at | Number | TTLï¼ˆ24æ™‚é–“å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰ |
| post_id | String | æœ€åˆã«ç™»éŒ²ã•ã‚ŒãŸæŠ•ç¨¿IDï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹ç”¨ï¼‰ |

---

## ğŸ’° ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

### å‰æï¼ˆ3ãƒ¶æœˆé‹ç”¨ï¼‰
- æœˆé–“æŠ•ç¨¿: 500ä»¶
- æœˆé–“PV: 5,000
- AIå‘¼ã³å‡ºã—: 1,500å›/æœˆ

### AWSï¼ˆAIé™¤ãï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | æœˆé¡ |
|---------|------|
| Lambda | $0ï¼ˆAlways Freeç¯„å›²å†…ï¼‰ |
| DynamoDB | $0.21 |
| S3 | $0 |
| CloudFront | $0 |
| API Gateway | $0 |
| CloudWatch | $0.05 |
| **åˆè¨ˆ** | **$0.26/æœˆ** |

### AI API

| API | å˜ä¾¡ | æœˆé¡ï¼ˆ500æŠ•ç¨¿ï¼‰ |
|-----|------|----------------|
| Gemini Pro | ~$0.001 | $0.50 |
| GLM-4 | ~$0.002 | $1.00 |
| GPT-4o-mini | ~$0.0015 | $0.75 |
| **åˆè¨ˆ** | - | **$2.25/æœˆ** |

### 3ãƒ¶æœˆç·ã‚³ã‚¹ãƒˆ
- AWS: $0.78
- AI: $6.75
- **åˆè¨ˆ: $7.53**

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿
- âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆIP/ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ 5åˆ†åˆ¶é™ï¼‰
- âœ… ã‚¹ãƒ‘ãƒ æ¤œå‡ºï¼ˆåŒä¸€ãƒ†ã‚­ã‚¹ãƒˆ24æ™‚é–“åˆ¶é™ï¼‰
- âœ… å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… HTTPSå¼·åˆ¶ï¼ˆCloudFrontï¼‰
- âœ… CORSè¨­å®š
- âœ… API Keyç’°å¢ƒå¤‰æ•°ç®¡ç†
- âœ… Brakemanï¼ˆè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ï¼‰

### ä»Šå¾Œã®æ¤œè¨
- ğŸ”œ reCAPTCHA
- ğŸ”œ ä¸é©åˆ‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

---

## ğŸ“Š ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

### CloudWatch
- äºˆç®—è¶…éã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆ$10ï¼‰
- Lambda ã‚¨ãƒ©ãƒ¼ï¼ˆ5å›ä»¥ä¸Šï¼‰
- DynamoDB ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°

### ãƒ­ã‚°
- CloudWatch Logs: 7æ—¥é–“ä¿å­˜

---

## ğŸ“„ åˆ©ç”¨è¦ç´„ & ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼

### æ¦‚è¦
æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã‚‹ã‚ã‚‹ã€ã‚’æŠ•ç¨¿ã—ã€AIãŒæ¡ç‚¹ã™ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„
- **æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿**: ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã€ãƒ†ã‚­ã‚¹ãƒˆã€ã‚¹ã‚³ã‚¢ã¯å…¬é–‹ã•ã‚Œã€æ°¸ä¹…ä¿å­˜ã•ã‚Œã¾ã™ã€‚
- **LocalStorage**: è‡ªåˆ†ã®æŠ•ç¨¿ã®å¼·èª¿è¡¨ç¤ºã®ãŸã‚ã«ä½¿ç”¨ã€‚å€‹äººã‚’ç‰¹å®šã™ã‚‹æƒ…å ±ã¯åé›†ã—ã¾ã›ã‚“ã€‚
- **Google Analytics**: åŒ¿åã®ã‚¢ã‚¯ã‚»ã‚¹è§£æã‚’è¡Œã„ã¾ã™ã€‚

### ç¦æ­¢äº‹é …
- æ³•ä»¤é•å
- èª¹è¬—ä¸­å‚·
- éåº¦ãªæ€§çš„ãƒ»æš´åŠ›çš„å†…å®¹
- ã‚¹ãƒ‘ãƒ ãƒ»é€£æŠ•

### å…è²¬äº‹é …
- AIæ¡ç‚¹ã¯ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆç›®çš„ã§ã‚ã‚Šã€æ­£ç¢ºæ€§ãƒ»å…¬å¹³æ€§ã‚’ä¿è¨¼ã—ã¾ã›ã‚“ã€‚
- æœ¬ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸæå®³ã«ã¤ã„ã¦ã€é‹å–¶è€…ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚

### ãŠå•ã„åˆã‚ã›
aruaruarena.official@gmail.com

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### DynamoDB Localã«æ¥ç¶šã§ããªã„
```bash
docker ps  # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ç¢ºèª
curl http://localhost:8000
```

### AI APIãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- API Keyã®æœ‰åŠ¹æ€§ç¢ºèª
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç¢ºèª

### Cold StartãŒé…ã„
```bash
# EventBridgeå‹•ä½œç¢ºèª
aws events list-rules --name-prefix aruaruarena
```

---

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Fork
2. Feature ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
3. Commit
4. Push
5. Pull Request

---

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

## ğŸ‘¥ ä½œè€…

- GitHub: [@yourusername](https://github.com/yourusername)
- Contact: aruaruarena.official@gmail.com

---

**ğŸŸï¸ ã‚ã‚‹ã‚ã‚‹ã‚¢ãƒªãƒ¼ãƒŠã§ã€ã‚ãªãŸã®ã€Œã‚ã‚‹ã‚ã‚‹ã€ã‚’ä¸–ç•Œã«å±Šã‘ã‚ˆã†ï¼**
